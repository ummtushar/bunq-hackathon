"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["ui_packages_relay-environment_relay-environment_ts"],{15930:(e,t,r)=>{let s;r.d(t,{H:()=>y});var n=r(10204);let AliveSession=class AliveSession extends n.ib{getUrlFromRefreshUrl(){return i(this.refreshUrl)}constructor(e,t,r,s,n){super(e,()=>this.getUrlFromRefreshUrl(),r,s,void 0,n),this.refreshUrl=t}};async function i(e){let t=await o(e);return t&&t.url&&t.token?a(t.url,t.token):null}async function o(e){let t=await fetch(e,{headers:{Accept:"application/json"}});if(t.ok)return t.json();if(404===t.status)return null;throw Error("fetch error")}async function a(e,t){let r=await fetch(e,{method:"POST",mode:"same-origin",headers:{"Scoped-CSRF-Token":t}});if(r.ok)return r.text();throw Error("fetch error")}var c=r(70170),u=r(75028),l=r(80688),d=r(23683),h=r(75632);function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e,{channel:t,type:r,data:s}){for(let n of e)n.dispatchEvent(new CustomEvent(`socket:${r}`,{bubbles:!1,cancelable:!1,detail:{name:t,data:s}}))}let b=class AliveSessionProxy{subscribe(e){let t=this.subscriptions.add(...e);t.length&&this.worker.port.postMessage({subscribe:t});let r=new Set(t.map(e=>e.name)),s=e.reduce((e,t)=>{let s=t.topic.name;return(0,n.JR)(s)&&!r.has(s)&&e.add(s),e},new Set);s.size&&this.worker.port.postMessage({requestPresence:Array.from(s)})}unsubscribeAll(...e){let t=this.subscriptions.drain(...e);t.length&&this.worker.port.postMessage({unsubscribe:t});let r=this.presenceMetadata.removeSubscribers(e);this.sendPresenceMetadataUpdate(r)}updatePresenceMetadata(e){let t=new Set;for(let r of e)this.presenceMetadata.setMetadata(r),t.add(r.channelName);this.sendPresenceMetadataUpdate(t)}sendPresenceMetadataUpdate(e){if(!e.size)return;let t=[];for(let r of e)t.push({channelName:r,metadata:this.presenceMetadata.getChannelMetadata(r)});this.worker.port.postMessage({updatePresenceMetadata:t})}online(){this.worker.port.postMessage({online:!0})}offline(){this.worker.port.postMessage({online:!1})}hangup(){this.worker.port.postMessage({hangup:!0})}receive(e){let{channel:t}=e;if("presence"===e.type){let r=this.notifyPresenceDebouncedByChannel.get(t);r||(r=(0,c.s)((e,r)=>{this.notify(e,r),this.notifyPresenceDebouncedByChannel.delete(t)},100),this.notifyPresenceDebouncedByChannel.set(t,r)),r(this.subscriptions.subscribers(t),e);return}this.notify(this.subscriptions.subscribers(t),e)}constructor(e,t,r,s,i,o){p(this,"worker",void 0),p(this,"subscriptions",new n.m0),p(this,"presenceMetadata",new n.VH),p(this,"notify",void 0),p(this,"notifyPresenceDebouncedByChannel",new Map),this.notify=i,this.worker=new SharedWorker(`${e}?module=true`,{name:`github-socket-worker-v3-${s}`,type:"module"}),this.worker.port.onmessage=({data:e})=>this.receive(e),this.worker.port.postMessage({connect:{url:t,refreshUrl:r,options:o}})}};async function g(){let e=function(){let e=document.head.querySelector("link[rel=shared-web-socket-src]")?.getAttribute("href");return e&&e.startsWith("/")?e:null}();if(!e)return;let t=document.head.querySelector("link[rel=shared-web-socket]")?.href??null;if(!t)return;let r=document.head.querySelector("link[rel=shared-web-socket]")?.getAttribute("data-refresh-url")??null;if(!r)return;let s=document.head.querySelector("link[rel=shared-web-socket]")?.getAttribute("data-session-id")??null;if(!s)return;let n=(()=>{let n=(0,h.G7)("alive_legacy_retries")?{socketPolicy:{timeout:4e3,attempts:7}}:{};if(!(0,d.nr)()&&"SharedWorker"in window&&"true"!==(0,l.A)("localStorage").getItem("bypassSharedWorker"))try{return new b(e,t,r,s,f,n)}catch{}return new AliveSession(t,r,!1,f,n)})();return window.addEventListener("online",()=>n.online()),window.addEventListener("offline",()=>n.offline()),window.addEventListener("pagehide",()=>{"hangup"in n&&n.hangup()}),n}async function w(){return await u.G,g()}function y(){return s||(s=w())}},88853:(e,t,r)=>{r.d(t,{$:()=>n});var s=r(10204);function n(e,t,r){if(!e)throw Error("Not connected to alive");if(!t)throw Error("No channel name");let n=s.KK.parse(t);if(!n)throw Error("Invalid channel name");let i={subscriber:{dispatchEvent:e=>{e instanceof CustomEvent&&r(e.detail.data)}},topic:n};return e.subscribe([i]),{unsubscribe:()=>e.unsubscribeAll(i.subscriber)}}},56366:(e,t,r)=>{r.d(t,{Av:()=>a,BM:()=>n,Gr:()=>c,HX:()=>d,M_:()=>h,RD:()=>l,rb:()=>i});var s=r(47584);let n="GraphQLTraces",i="GraphQLTracingRefresh",o=decodeURIComponent(new URLSearchParams(s.fV.search).get("disable_clusters")||"").split(",").filter(e=>""!==e);function a(e){if(!s.cg||!c()||!e)return;let t=s.cg;t&&!t[n]&&(t[n]=[]),t&&e.__trace&&(t[n].push(e.__trace),"function"==typeof t[i]&&t[i]())}function c(){let e=s.cg;return"true"===new URLSearchParams(s.fV.search).get("_tracing")||e&&void 0!==e[n]}function u(){return o.length>0}function l(e){if(!c()&&!u())return e;let t=new URL(e,s.fV.origin);return c()&&t.searchParams.set("_tracing","true"),u()&&t.searchParams.set("disable_clusters",o.join(",")),t.pathname+t.search}function d(e){return o.indexOf(e)>-1}function h(e){let t=o.indexOf(e);t>-1?o.splice(t,1):o.push(e);let r=new URLSearchParams(s.fV.search);r.set("disable_clusters",o.join(",")),s.fV.search=r.toString()}},79317:(e,t,r)=>{r.d(t,{VB:()=>SSRNetwork,SD:()=>R,E7:()=>O});var s=r(40961),n=r(69487),i=r(56366),o=r(57572),a=r(47584),c=r(42445);let u=["SAML","SERVICE_UNAVAILABLE"],l={FORBIDDEN:["SAML error"],AUTHENTICATION:["Couldn\u2019t authenticate you"]},d={NOT_FOUND:["repository","discussion"]};var h=r(75632);let p=class ValidationError extends Error{constructor(e,t,r){super(e,t),function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(this,"catalogService",void 0),this.catalogService=r,this.name="ValidationError"}};async function f(e,t,r){if(e.status>401&&404!==e.status){let s=await e.text(),n={url:e.url,timestamp:new Date().toISOString(),persistedQueryId:t,persistedQueryName:r,failureRequestId:e.headers.get("X-Github-Request-Id")};throw Error(`HTTP error (${e.status}): ${s||"No additional text"}.
    Error Info: ${JSON.stringify(n)}`,{cause:e.status})}}async function b(e,t,r,s="GET",n,i,o,a){return(await g(e,t,r,s,{isSubscription:!1,scope:void 0},n,i,o,a)).response}async function g(e,t,r,s="POST",o={},f,b,y,m){let S=JSON.stringify((0,n.stableCopy)({query:e,variables:r,...o.scopeObject?{scopeObject:o.scopeObject}:{}})),{isSubscription:v,scope:k,subscriptionTopic:P,dispatchTime:E}=o,_=(0,h.G7)("nonreporting_relay_graphql_status_codes"),O=function(e,t,r,s,n,i,o="/_graphql"){let c=[];if("GET"===e&&c.push(`body=${t}`),r&&c.push("subscription=1"),n&&c.push(`scope=${encodeURIComponent(n)}`),s&&c.push(`subscriptionTopic=${encodeURIComponent(s)}`),i&&c.push(`dispatchTime=${encodeURIComponent(i)}`),a.cg){let e=new URL(a.cg.location.href,a.cg.location.origin).searchParams.get("_features");e&&c.push(`_features=${e}`)}return c.length>0?`${o}?${c.join("&")}`:o}(s,encodeURIComponent(S),v,P,k,E,f),R=null;try{let{subscriptionId:r,requestId:n,json:o,status:a}=await w(O,s,e,t,S,b);if(R=r,y&&o.errors){let e=y[a];if(e)for(let r of o.errors){let s=e[r.type];s?.({persistedQueryName:t,errorMessage:r.message})}}let h=function(e,t,r,s){if("errors"in e&&(e.errors.filter(e=>u.includes(e.type)||!!l[e.type]?.includes(e.message)||!(JSON.stringify(d[e.type])!==JSON.stringify(e.path))).map(e=>{console.error(`Failed to fetch data. Please use this request ID when contacting support: ${t} Error: ${e.type}: ${e.message} (path: ${e.path})`)}),e.errors=e.errors.filter(e=>!u.includes(e.type)&&!l[e.type]?.includes(e.message)&&JSON.stringify(d[e.type])!==JSON.stringify(e.path))),"errors"in e&&e.errors.length){let t=e.errors.map(e=>`GraphQL error: ${e.type}: ${e.message} (path: ${e.path})`).join(", "),n=new p(`${t} (Persisted query id: ${r})`,{cause:e.errors},e.extensions?.query_owning_catalog_service);if(s)(0,c.N7)(n),s.error(n);else throw n}if(!("data"in e)){let n=Error(`Expected data property in response: ${JSON.stringify(e)}. persistedQueryId: ${r}, requestId: ${t}`);if(s)(0,c.N7)(n),s.error(n);else throw n}return e}(o,n,e,m);return h&&(0,i.Av)(h),{subscriptionId:R,response:h}}catch(e){if(m)return _&&429===e.cause||(0,c.N7)(e),m.error(e),{subscriptionId:R,response:{errors:[{message:"An error occurred while fetching data. Please try again later."}],extensions:{}}};throw e}}async function w(e,t,r,s,n,o){return y((0,i.RD)(e),t,r,s,n,o)}async function y(e,t,r,s,n,i){let a;let c={};i?.issues_react_perf_test&&(c["X-LUC-Environment"]="issues"),c["X-Requested-With"]="XMLHttpRequest",a="GET"===t?await fetch(e,{method:t,cache:"no-cache",credentials:"include",headers:c}):await (0,o.DI)(e,{method:t,headers:{Accept:"application/json",...c},...n?{body:n}:void 0}),await f(a,r,s);let u=await a.json();return{subscriptionId:a.headers.get("X-Subscription-ID"),requestId:a.headers.get("X-Github-Request-Id")||"",json:u,status:a.status}}let m=[{kind:"linked",handle(e,t,r){if(null!=t&&t.getType()===n.ROOT_TYPE&&"node"===e.name&&r.hasOwnProperty("id"))return r.id}},{kind:"pluralLinked",handle(e,t,r){if(null!=t&&t.getType()===n.ROOT_TYPE&&"nodes"===e.name&&r.hasOwnProperty("ids"))return r.ids}}];var S=r(15930),v=r(88853),k=r(69982);function P(e){return(0,k.unstable_scheduleCallback)(k.unstable_LowPriority,e)}function E(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let _={cancel:()=>!1,schedule:e=>((0,s.unstable_batchedUpdates)(e),"")};let SSRNetwork=class SSRNetwork{execute(e,t,r){return this.relayNetwork.execute(e,t,r)}getPreloadedSubscriptions(){return this.preloadedSubscriptions}constructor(e,t={},r,s,i,o){E(this,"relayNetwork",void 0),E(this,"ssrPreloadedData",void 0),E(this,"preloadedSubscriptions",void 0),E(this,"warningsShown",void 0),E(this,"enabled_features",void 0),E(this,"maxAge",void 0),E(this,"errorCallbacks",void 0),this.ssrPreloadedData=e,this.enabled_features=t,this.preloadedSubscriptions=r,this.warningsShown=new Set,this.maxAge=i,this.errorCallbacks=o,this.relayNetwork=n.Network.create((e,t)=>n.Observable.create(r=>{let n=function({params:e,variables:t,ssrPreloadedQueries:r,baseUrl:s,emitWarning:n,enabledFeatures:i,maxAge:o,errorCallbacks:c,observer:u}){if(!e.id)throw Error("params has no id property!");if(e.id&&r){let s=JSON.stringify(t),n=r.get(e.id)?.get(s),i=Math.floor(Date.now()/1e3),c=n?.timestamp;if(n&&(u.next(n),!(o&&c&&i>c+o))){u.complete();return}e.metadata?.isRelayRouteRequest&&(0,a.g5)()}let l="mutation"===e.operationKind?"POST":"GET";if(a.KJ)return b(e.id,e.name,t,l,s,i,c,u)}({params:e,variables:t,ssrPreloadedQueries:this.ssrPreloadedData,baseUrl:s,emitWarning:e=>{this.warningsShown.has(e)||(this.warningsShown.add(e),console.warn(e))},enabledFeatures:this.enabled_features,maxAge:i,errorCallbacks:this.errorCallbacks,observer:r});n instanceof Promise&&n.then(e=>{if(!Array.isArray(e)&&"extensions"in e&&e.extensions&&e.extensions.subscriptions){let t=e.extensions.subscriptions;for(let e in t)for(let r in this.preloadedSubscriptions.has(e)||this.preloadedSubscriptions.set(e,new Map),t[e])this.preloadedSubscriptions.get(e)?.set(r,t[e][r])}r.next(e),r.complete()})}),(e,t)=>(function(e,t,r=new Map){let s=e.id,i=e.name;return n.Observable.create(n=>{let o=()=>{},a=!1;return async function(){if(!s)throw Error("unexpected operation with no id!");let u=e.metadata?.scope,l=function(e,t,r,s){let n=s.get(e);if(n)e:for(let[e,s]of n){for(let[s,n]of Object.entries(JSON.parse(e)))if("$scope"===s&&r!==n||t[s]!==n)continue e;return s}}(s,t,u,r),d=null;if(l)d=l.subscriptionId,l.response&&n.next(l.response);else try{let e=await g(s,i,t,"GET",{isSubscription:!0,scope:u});d=e.subscriptionId,e.response&&n.next(e.response)}catch(e){if(e instanceof Error&&e.message.includes("Subscription halted"))return;throw e}try{let e=await (0,S.H)();if(a)return;let r=(0,v.$)(e,d,async({scope_object:e,subscription_topic:r,dispatch_time:o})=>{try{let{response:a}=await g(s,i,{...t},"GET",{isSubscription:!0,scopeObject:e,subscriptionTopic:r,dispatchTime:o,scope:u});a&&n.next(a)}catch(e){(0,c.N7)(e,{message:`Error in fetching update for ${s} with variables ${JSON.stringify(t)}`})}});r?.unsubscribe&&(o=r.unsubscribe)}catch(e){n.error(e)}}(),{get closed(){return a},unsubscribe(){a=!0,o()}}})})(e,t,this.preloadedSubscriptions))}};let O=(e,t)=>{let r=new SSRNetwork(new Map,{},new Map,e,void 0,t),s=new n.Environment({scheduler:_,store:new n.Store(new n.RecordSource,{gcReleaseBufferSize:50,queryCacheExpirationTime:3e5,gcScheduler:P}),getDataID:(e,t)=>{if("Viewer"===t)return null==e.id?(0,n.generateClientID)("client:root","viewer"):e.id;if("ProjectV2SingleSelectFieldOption"===t){let t=[];return e.id&&t.push(e.id),e.name&&t.push(e.name),e.color&&t.push(e.color),e.description&&t.push(function(e){let t=0;if(0===e.length)return t;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r)|0;return t}(e.description)),t.join("_")}return e.id},network:r,missingFieldHandlers:m});return s.options={baseUrl:e,getPreloadedSubscriptions:()=>r.getPreloadedSubscriptions()},s};function R({environment:e,query:t,variables:r={}}){let s=(0,n.getRequest)(t),i=(0,n.createOperationDescriptor)(s,r);return e.retain(i),(0,n.fetchQuery)(e,t,r,{fetchPolicy:"store-or-network"})}}}]);
//# sourceMappingURL=ui_packages_relay-environment_relay-environment_ts-51f8139255b2.js.map